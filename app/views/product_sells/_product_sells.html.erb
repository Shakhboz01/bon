<%= turbo_frame_tag 'product_sells' do %>
  <table class="table table-hover table-bordered table-striped">
    <thead>
      <tr>
        <% unless defined?(shrink) %>
          <th>ID</th>
          <th>Mijoz</th>
        <% end %>
        <th>Tovar</th>
        <th>Soni</th>
        <th>Narxi</th>
        <th>Jami</th>
        <% unless defined?(shrink) %>
          <th>Kim tomondan</th>
          <th>Sotilgan sana</th>
        <% end %>
        <th colspan="3"></th>
      </tr>
    </thead>
      <tbody>
        <% product_sells.each do |product_sell| %>
          <tr>
            <% unless defined?(shrink) %>
              <td><%= product_sell.id %></td>
              <td><%= product_sell.buyer.name %></td>
            <% end %>
            <td>
              <% if product_sell.product.nil? %>
                <%= product_sell.pack.name %>
              <% else %>
                <%= product_sell.product.name %>
              <% end %>
            </td>
            <td><%= product_sell.amount.to_i %></td>
            <td><%= num_to_usd product_sell.sell_price %></td>
            <td><%= num_to_usd(product_sell.sell_price * product_sell.amount) %></td>
            <% unless defined?(shrink) %>
              <td><%= currency_convert(product_sell.price_in_usd, product_sell.sell_price) %></td>
            <% end %>
            <% unless defined?(shrink) %>
              <td><%= product_sell.user.name %></td>
              <td><%= strf_datetime(product_sell.created_at) %></td>
            <% end %>
            <td><%= cdlink_to 'Удалить', product_sell %></td>
          </tr>
        <% end %>
      </tbody>
  </table>

  <% if defined?(shrink) %>
    <div class='d-flex justify-content-around'>
    <% rate = CurrencyRate.last.rate %>
    <b>JAMI: <%= num_to_usd product_sells.sum('(sell_price * amount)') %></b>
    <b>UMUMIY TOVARLAR SONI: <%= @sale.product_sells.sum(:amount) %></b>
  </div>
  <% end %>
<% end %>
