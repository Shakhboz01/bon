<div class="container my-5">
  <div class="card shadow">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h3 class="card-title font-weight-bold">Товары</h3>
      <%= link_to 'Добавить новый', new_product_path, class: 'btn btn-primary' %>
    </div>
    <div class="card-body">
      <% if @products.any? -%>
        <table class="table table-bordered table-striped table-hover">
          <thead>
            <tr>
              <th>Название</th>
              <th>остаток</th>
              <th>сумма на расход</th>
              <th>средняя</th>
              <th>Товар cоздан в:</th>
              <th>Действия</th>
            </tr>
          </thead>
          <tbody>
            <% @products.each do |product| -%>
              <tr>
                <td><%= product.name %></td>
                <% if policy(:view).access? %>
                <td><%= product.amount_left %></td>
                <td><%= num_to_usd(product.expenditures.sum(:price)) %></td>
                <td><%= num_to_usd(product.expenditures.sum(:price).to_f / product.amount_left) %></td>
                <td><%= product.created_at.strftime('%Y-%m-%d %H:%M:%S') %></td>
                <% end %>
                <td>
                <% if policy(:view).access? %>
                  <%# create a link here that navigates to expenditure index with params of product_id_eq equal to product.id  %>
                  <%= clink_to 'посмотреть детально', product_expenditure_expenditures_path(q: {product_id_eq: product.id}), 'fa-eye' %>
                  <%= clink_to 'редактировать', edit_product_path(product), 'fa-edit' %>
                <% end %>
                </td>
                <td>
                  <%= clink_to 'Добить приход товара', new_expenditure_path(product_id: product.id, expenditure_type: Expenditure.expenditure_types.keys.first ), 'fa-truck-ramp-box' %>
                </td>
              </tr>
            <% end -%>
          </tbody>
        </table>
      <% else -%>
        <p class="text-center">Товаров нет.</p>
      <% end -%>
    </div>
  </div>
</div>
