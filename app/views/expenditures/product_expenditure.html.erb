<div class="container m-auto">
  <div class="card shadow">
    <%= render 'index_filter_form', type: 'for_product', url: request.path, q: @q %>
    <div class= 'card-header'>
      <h3>Расход на товар</h3>
    </div>
    <div class="card-body">
      <div class="sum-of-prices mb-3 d-flex" style='justify-content: space-evenly'>
        <strong>Сумма фактических цен: <%= num_to_usd(@sum) %></strong>
        <strong>Сумма реальных цен: <%= num_to_usd(@total_paid_sum) %></strong>
      </div>
      <table class="table table-bordered table-striped table-hover">
        <thead>
          <tr>
            <th><%= sort_link @q, :id, 'ID' %></th>
            <th><%= sort_link @q, :expenditure_type, 'Тип расхода' %></th>
            <th><%= sort_link @q, :product_id, 'Товар' %></th>
            <th><%= sort_link @q, :quantity, 'Кол.' %></th>
            <th><%= sort_link @q, :price, 'Цена' %></th>
            <th><%= sort_link @q, :total_paid, 'Дано' %></th>
            <th><%= sort_link @q, :outcomer_id, 'Кому' %></th>
            <th><%= sort_link @q, :executor, 'Исполнитель' %></th>
            <th><%= sort_link @q, :comment, 'Коммент' %></th>
            <th><%= sort_link @q, :created_at, 'Создано в' %></th>
            <th><%= sort_link @q, :uodated_at, 'Редактировано в' %></th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <% @product_expenditures.each do |expenditure| -%>
            <tr>
              <%= expenditure_color(expenditure) %>
              <td><%= expenditure.expenditure_type %></td>
              <td><%= expenditure&.product&.name %></td>
              <td><%= expenditure&.quantity %></td>
              <td><%= num_to_usd(expenditure.price) %></td>
              <td><%= expenditure.expenditure_type == 'на_товар' ? num_to_usd(expenditure.total_paid) : '' %></td>
              <td><%= expenditure.outcomer.name %></td>
              <td><%= User.find(expenditure.executor_id)&.name %></td>
              <td><%= expenditure.comment %></td>
              <td><%= expenditure.created_at.strftime('%Y-%m-%d %H:%M') %></td>
              <td><%= expenditure.updated_at.strftime('%Y-%m-%d %H:%M') %></td>
              <td>
                <%= clink_to 'редактировать', edit_expenditure_path(expenditure), 'fa-edit' %>
              </td>
            </tr>
          <% end -%>
        </tbody>
      </table>
      <%= paginate @product_expenditures %>
    </div>
  </div>
</div>
