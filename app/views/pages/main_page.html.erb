<div style='margin: auto 10px'>
  <%= render 'filter_form', url: request.path %>
  <div class='row'>
    <div class='col-sm-2'>
      <h2 class='text-center'>Клиенты</h2>
      <table class='table shadow table-hover table-striped'>
        <thead>
          <tr>
            <th>ID</th>
            <th>Разница</th>
            <th>Имя</th>
          </tr>
        </thead>
        <tbody>
          <% @outcomers.each do |outcomer| %>
            <% if (outcomer.expenditures.sum(:total_paid) - outcomer.expenditures.sum(:price)) != 0 ||
             (outcomer.incomes.sum(:total_paid) - outcomer.incomes.sum(:price)) != 0
            %>
              <tr>
                <%= calculate_difference(outcomer) %>
                <td>
                  <% if outcomer.role == 'покупатель' %>
                    <i class="fa-solid fa-dollar-sign"></i>
                  <% end %>
                  <%= outcomer.name.capitalize() %>
                </td>
              </tr>
            <% end %>
          <% end %>
        </tbody>
      </table>
    </div>
    <div class='col-sm-4'>
      <h2 class='text-center'>Доходы (<%= num_to_usd(@incomes.sum(:price)) %>) </h2>
      <table class='table shadow table-hover table-striped'>
        <thead>
          <tr>
            <th>ID</th>
            <th>Покупатель</th>
            <th>Продукт</th>
            <th>Сумма</th>
            <th>Оплачен</th>
          </tr>
        </thead>
        <tbody>
          <% @incomes.each do |income| %>
            <tr>
              <td><%= income.id %></td>
              <td><%= income.outcomer.name %></td>
              <td><%= income.product.name %></td>
              <td><%= num_to_usd(income.product.price) %></td>
              <td><%= num_to_usd(income.product.total_paid) %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
    <div class='col-sm-6'>
      <h2 class='text-center'>Расходы (<%= num_to_usd(@expenditures.sum(:price)) %>)</h2>
      <table class='table shadow table-hover table-striped'>
        <thead>
          <tr>
            <th>ID</th>
            <th>Тип</th>
            <th>Стоимость</th>
            <th>Оплачен</th>
            <th>Поставщик</th>
            <th>Количество</th>
            <th>Работник</th>
          </tr>
        </thead>
        <tbody>
          <% @expenditures.each do |expenditure| %>
            <tr>
              <%= expenditure_color(expenditure) %>
              <td><%= expenditure.expenditure_type %></td>
              <td><%= num_to_usd(expenditure.price) %></td>
              <td><%= expenditure.expenditure_type == 'на_товар' ? num_to_usd(expenditure&.total_paid) : '' %></td>
              <td><%= expenditure&.outcomer&.name %></td>
              <td><%= expenditure&.quantity %></td>
              <td><%= expenditure&.user&.name %></td>
              <% if expenditure.expenditure_type == 'на_товар' %>
                <td><%= clink_to 'редактировать', edit_expenditure_path(expenditure), 'fa-edit' %></td>
              <% end %>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>
