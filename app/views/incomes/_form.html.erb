<% unless @for_transaction %>
  <h3><%= @product&.name %></h3>
<% end %>

<%= simple_form_for(@income, html: { class: 'form-horizontal shadow' }) do |f| %>
  <%= f.error_notification %>
  <%= f.error_notification message: f.object.errors[:base].to_sentence if f.object.errors[:base].present? %>

  <div class="form-inputs">
    <% if !@for_transaction %>

      <%= f.hidden_field :product_id, value: @product.id %>
      <%= f.input :quantity, label: 'Количество' %>

      <%= f.label :outcomer_id, 'Покупатель:' %>
      <%= f.select :outcomer_id, options_for_select(Outcomer.покупатель.where(active_outcomer: true).order(:name).pluck(:name, :id), @income.outcomer_id), { include_blank: false, label: 'Выберите Поставщика', required: true, autofocus: true, multiple: true }, { class: 'form-control custom-select-lg', size: 5 } %>
      <br>

      <%= f.label :product_price, 'Выберите цену:' %>
      <%= f.select :product_price, options_for_select(@product.product_prices.map { |pp| [pp.price, pp.price, { selected: !@income.price.nil? && pp.price == @income.price / (@income.quantity.zero? ? 1 : @income.quantity) }] }), { include_blank: false, required: true, autofocus: true, multiple: true }, { class: 'form-control', size: 3 } %>
      <br>

      <% if policy(:view).access? %>
        <%= f.input :total_paid, label: 'Оплачен' %>
      <% end %>
    <% end %>

    <% if @action == 'transaction' %>
      <%= f.association :outcomer, collection: Outcomer.покупатель.where(active_outcomer: true).where(role: :поставщик).order(:name).pluck(:name, :id), class: 'form form-control', include_blank: false, label: 'Поставщик' %>
    <% end %>

    <% if @for_transaction %>
      <%= f.input :price, label: 'цена' %>
    <% end %>
  </div>

  <div class="form-actions">
    <%= f.button :submit, 'Завершить', class: 'btn btn-primary mb-5' %>
  </div>
<% end %>
